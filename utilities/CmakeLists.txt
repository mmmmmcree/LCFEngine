project(utilities)

file(GLOB_RECURSE HEADERS "include/*.h")
file(GLOB_RECURSE SOURCES "src/*.cpp")

add_library(${PROJECT_NAME} SHARED
    ${HEADERS}
    ${SOURCES}
)

if(WIN32)
    set_target_properties(${PROJECT_NAME} PROPERTIES
        WINDOWS_EXPORT_ALL_SYMBOLS ON
        RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/$<CONFIG>
        ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib/$<CONFIG>
    )
endif()

find_package(Stb REQUIRED)
find_package(Boost REQUIRED)
find_package(magic_enum CONFIG REQUIRED)
find_package(nlohmann_json CONFIG REQUIRED)
find_package(PNG REQUIRED)    
find_package(JPEG REQUIRED)
find_package(spdlog REQUIRED)

file(GLOB_RECURSE INCLUDE_DIRS CONFIGURE_DEPENDS LIST_DIRECTORIES true "${CMAKE_CURRENT_SOURCE_DIR}/include/*")
set(DIRS_ONLY "")
foreach(ITEM ${INCLUDE_DIRS})
  if(IS_DIRECTORY ${ITEM})
    list(APPEND DIRS_ONLY ${ITEM})
  endif() 
endforeach()
include_directories(
  ${CMAKE_CURRENT_SOURCE_DIR}/include 
  ${DIRS_ONLY}
)
 
target_include_directories(${PROJECT_NAME}
    PUBLIC
        $<INSTALL_INTERFACE:include>
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
    PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}/src
        ${Stb_INCLUDE_DIR} 
)

target_link_libraries(${PROJECT_NAME} 
  PUBLIC
    magic_enum::magic_enum
    Boost::headers 
    nlohmann_json::nlohmann_json
    spdlog::spdlog
  PRIVATE
    PNG::PNG
    JPEG::JPEG
)    